<div
  [cdkContextMenuTriggerFor]="contextMenu"
  class="piece-layers"
  [class.unsynced]="part.isUnsynced"
>
  <div *ngFor="let outputLayer of outputLayers" class="piece-layer">
    <sofie-offsetable-piece
      *ngIf="piecesGroupedByOutputLayer[outputLayer] && piecesGroupedByOutputLayer[outputLayer].length === 1"
      [piece]="piecesGroupedByOutputLayer[outputLayer][0]"
      [pixelsPerSecond]="pixelsPerSecond"
      [partDuration]="partDurationInMs()"
      [playedDurationForPartInMs]="playedDurationInMs"
      [prePlayheadDurationInMs]="prePlayheadDurationInMs"
      [postPlayheadDurationInMs]="postPlayheadDurationInMs">
    </sofie-offsetable-piece>
    <sofie-offsetable-stack
      *ngIf="piecesGroupedByOutputLayer[outputLayer] && piecesGroupedByOutputLayer[outputLayer].length > 1"
      class="piece-layer"
      [outputLayer]="outputLayer"
      [piecesForStack]="piecesGroupedByOutputLayer[outputLayer]">
    </sofie-offsetable-stack>
  </div>
</div>
<sofie-timeline-flag [label]="part.isNext ? (isAutoNextStarted ? autoLabel : nextLabel) : undefined" [turnedOn]="part.isNext"></sofie-timeline-flag>

<ng-template #contextMenu>
  <sofie-part-context-menu *ngIf="isRundownActive" [part]="part" [rundownId]="rundownId"></sofie-part-context-menu>
</ng-template>
