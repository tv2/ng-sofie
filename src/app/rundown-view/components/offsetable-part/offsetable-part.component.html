<div [cdkContextMenuTriggerFor]="contextMenu" class="piece-layers" [class.unsynced]="part.isUnsynced" [class.invalid]="part.invalidity" sofieTooltip [sofieTooltipTemplate]="tooltipTemplate">
  <div *ngFor="let outputLayer of outputLayers" class="piece-layer">
    <sofie-offsetable-piece
      *ngFor="let piece of piecesGroupedByOutputLayer[outputLayer]; trackBy: trackPiece"
      [piece]="piece"
      [pixelsPerSecond]="pixelsPerSecond"
      [partDuration]="partDurationInMs()"
      [playedDurationForPartInMs]="playedDurationInMs"
      [prePlayheadDurationInMs]="prePlayheadDurationInMs"
      [postPlayheadDurationInMs]="postPlayheadDurationInMs">
    </sofie-offsetable-piece>
  </div>
</div>
<sofie-timeline-flag [label]="part.isNext ? (isAutoNextStarted ? autoLabel : nextLabel) : undefined" [turnedOn]="part.isNext"></sofie-timeline-flag>

<ng-template #contextMenu>
  <sofie-part-context-menu *ngIf="isRundownActiveOrRehearsal" [part]="part" [rundownId]="rundownId"></sofie-part-context-menu>
</ng-template>

<ng-template #tooltipTemplate>
  <sofie-invalid-part-tooltip *ngIf="part.invalidity" [invalidity]="part.invalidity"></sofie-invalid-part-tooltip>
</ng-template>
